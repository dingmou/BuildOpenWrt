#=================================================
# JUST A Test
# Author: Dingmou
#=================================================

name: List all

on:
  push:
    branches:
      - master

#  schedule:
#    - cron: 0 8 * * 5
#  watch:
#    types: started

env:
  REPO_URL: https://github.com/coolsnowwolf/lede
  REPO_BRANCH: master
  CONFIG_FILE: .config
  DIY_SH: diy.sh
  SSH_ACTIONS: false
  UPLOAD_BIN_DIR: false
  UPLOAD_FIRMWARE: true
  UPLOAD_COWTRANSFER: true
  UPLOAD_WETRANSFER: true
  TZ: Asia/Shanghai

jobs:
  build:
    runs-on: ubuntu-latest
    if: github.event.repository.owner.id == github.event.sender.id

    steps:
    - name: Clone addtional source code
      run: |
        mkdir openwrt        
        cd openwrt 
        git clone https://github.com/Lienol/openwrt-package package/lienol
        ls -la
 
    - name: Checkout
      uses: actions/checkout@master
             
    - name: List all
      run: |
        ls -la
        pwd
            
    - name: Copy files to package director
      run: |
        cp -r package/. openwrt/package

    - name: List all again
      run: |
        ls -la
        pwd
            

    - name: Download package
      id: package
      run: |
        cd openwrt
        make defconfig
        make download -j8
        find dl -size -1024c -exec ls -l {} \;
        find dl -size -1024c -exec rm -f {} \;

    - name: List all again at last
      run: |
        ls -la
        pwd

